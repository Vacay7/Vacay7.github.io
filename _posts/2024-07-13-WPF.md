---
title: WPF 笔记
date: 2024-07-13 00:00:00 +8000
categories: [编程]
tags: [WPF]
---

## 布局

1. StackPanel: 水平或垂直排列元素、Orientation属性分别: Horizontal / Vertical
2. WrapPanel : 水平或垂直排列元素、针对剩余空间不足会进行换行或换列进行排列
3. DockPanel : 根据容器的边界、元素进行Dock.Top、Left、Right、Bottom设置
4. Grid : 类似table表格、可灵活设置行列并放置控件元素
5. UniformGrid : 指定行和列的数量, 均分有限的容器空间
6. Canvas : 使用固定的坐标设置元素的位置、不具备锚定停靠等功能

## 控件

1. 布局控件：可以容纳多个控件或嵌套其他布局控件，用于在UI上组织和排列控件。Grid、StackPanel、DockPanel等控件都属此类，它们拥有共同的父类Panel
2. 内容控件：只能容纳一个其他控件或布局控件作为它的内容。Window、Button等控件属于此类，因为只能容纳一个控件作为其内容，所以经常需要借助布局控件来规划其内容。它们的共同父类是ContentControl
3. 带标题内容控件：相当于一个内容控件，但可以加一个标题（Header），标题部分亦可容纳一个控件或布局。GroupBox、TabItem等是这类控件的典型代表。它们的共同父类是HeaderedContentControl
4. 条目控件：可以显示一列数据，一般情况下这列数据的类型相同。此类控件包括ListBox、ComboBox等。它们的共同基类是ItemsControl。此类控件在显示集合类型数据方面功能非常强大
5. 带标题条目控件：相当于一个条目控件加上一个标题显示区。TreeViewItem、MenuItem都属于此类控件。这类控件往往用于显示层级关系数据，结点显示在其Header区域，子级结点则显示在其条目控件区域。此类控件的共同基类是HeaderedItemsControl
6. 特殊内容控件：比如TextBox容纳的是字符串、TextBlock可以容纳可自由控制格式的文本、Image容纳图片类型数据

## 样式

1. 字体(FontFamily)
2. 字体大小(FontSize)
3. 背景颜色(Background)
4. 字体颜色(Foreground)
5. 边距(Margin)
6. 水平位置(HorizontalAlignment)
7. 垂直位置(VerticalAlignment)
样式是组织和重用以上的重要工具。不是使用重复的标记填充XAML, 通过Style创建一系列封装所有这些细节的样式，然后通过Style属性应用封装好的样式

## 控件模板

ControlTemplate(控件模板)不仅是用于来定义控件的外观、样式, 还可通过控件模板的触发器(ControlTemplate.Triggers)修改控件的行为、响应动画等

## 数据模板

控件只是个数据和行为的载体、是个抽象的概念，至于它本身会长成什么样子（控件内部结构）、它的数据会长成什么样子（数据显示结构）都是靠Template生成的。决定控件外观的是ControlTemplate，决定数据外观的是DataTemplate，它们正是Control类的Template和ContentTemplate两个属性的值

## 绑定

数据绑定实质上是绑定目标与绑定源之间的桥梁
通常情况下，每个绑定具有四个组件：

- 绑定目标对象
- 目标属性
- 绑定源
- 指向绑定源中要使用的值的路径

**数据上下文**
当在 XAML 元素上声明数据绑定时，它们会通过查看其直接的 DataContext 属性来解析数据绑定。 数据上下文通常是绑定源值路径评估的绑定源对象。 可以在绑定中重写此行为，并设置特定的绑定源对象值。 如果未设置承载绑定的对象的 DataContext 属性，则将检查父元素的 DataContext 属性，依此类推，直到 XAML 对象树的根。 简而言之，除非在对象上显式设置，否则用于解析绑定的数据上下文将继承自父级。

## 第三方库

### NLog

```csharp
private void NLogConfig()
{
    string logFileName = "filename.log";
    NLog.LogManager.Setup().LoadConfiguration(builder =>
    {
        builder.ForLogger().FilterMinLevel(LogLevel.Info).WriteToFile(
                fileName: logFileName,
                layout: "${longdate}|${level:uppercase=true}|${message}",
                encoding: System.Text.Encoding.UTF8, // 字符编码
                archiveAboveSize: 50 * 1024 * 1024,  // 单个日志文件大小上限
                maxArchiveFiles: 1);                 // 文件归档上下(超过上限会进行删除)
    });
}
```

### ini-parser

```csharp
using IniParser;
using IniParser.Model;

// 写入
var parser = new FileIniDataParser();
var data = parser.ReadFile("config.ini");
data.Sections.AddSection("Section1");
data["Section1"]["Key1"] = "Value1";
parser.WriteFile("config.ini", data);

// 读取
var iniData = parser.ReadFile("config.ini");
string value = iniData["Section1"]["Key1"];
```

## 解决方案

### 加载SVG

1. 安装SharpVectors库
2. 添加SVG文件并把属性修改为资源
3. 添加命名空间`xmlns:svgc="http://sharpvectors.codeplex.com/svgc/`
4. 使用标签`<svgc:SvgViewbox IsHitTestVisible="False"  Source="Resources/logo.svg"/>`

### 使用第三方字体

1. 设置字体文件属性为资源
2. 在App.xaml文件，添加该字体资源

```xml
<Application.Resources>
    <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary>
                    <FontFamily x:Key="FontName">pack://application:,,,/Resources/Font/xxx.ttf</FontFamily>
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
  </Application.Resources>
```

### 文件选择对话框

```csharp
// 选择文件
var dialog = new Microsoft.Win32.OpenFileDialog();
dialog.Filter = "txt|*.txt"; // 限制选择txt类型的文件
if(dialog.ShowDialog()==true)
{
    var filePath = dialog.FileName; // 选择文件的完整路径
}

// 选择文件夹(需要引用System.WIndows.Form)
FolderBrowserDialog folderDialog = new FolderBrowserDialog();
folderDialog.Description = "请选择CSV文件存放目录";
folderDialog.RootFolder = Environment.SpecialFolder.MyComputer;
folderDialog.Selecte                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    dPath = GClass.WorkPath; // 设置默认打开的路径
DialogResult result = folderDialog.ShowDialog();
if (result == DialogResult.OK)
    CsvFolder = folderDialog.SelectedPath;

// 保存文件
SaveFileDialog saveFileDialog = new SaveFileDialog
{
    Filter = "生产文件|*.fil",
    RestoreDirectory = true
};
if (saveFileDialog.ShowDialog() == true)
{
    // 写入文件数据的动作
}
```

### 弹出虚拟键盘

安装Osklib.wpf，使用`Osklib.OnScreenKeyboard.Show()`

### 最大化不遮挡任务栏

```csharp
private void Button_Click(object sender, RoutedEventArgs e)
{
    if (this.WindowState == WindowState.Normal)
    {
        int actualWorkingAreaHeight = Screen.PrimaryScreen.WorkingArea.Height;
        int actualWorkingAreaWidth = Screen.PrimaryScreen.WorkingArea.Width;
        this.WindowState = WindowState.Maximized;
        this.Height = SystemParameters.MaximizedPrimaryScreenHeight;
        this.Width = SystemParameters.MaximizedPrimaryScreenWidth;
    }
    else if (this.WindowState == WindowState.Maximized)
    {
        this.WindowState = WindowState.Normal;
    }
}
```
